name: Windows Build
on: [push, pull_request]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install Visual Studio Build Tools
      uses: microsoft/setup-msbuild@v1.1.3

    - name: Install vcpkg for dependencies
      run: |
        git clone https://github.com/Microsoft/vcpkg.git
        .\vcpkg\bootstrap-vcpkg.bat
        .\vcpkg\vcpkg integrate install

    - name: Install MySQL Connector via vcpkg
      run: |
        .\vcpkg\vcpkg install mysql-connector-cpp

    - name: Install INI Parser (inih)
      run: |
        git clone https://github.com/benhoyt/inih.git libs/inih

    - name: Configure with CMake
      run: |
        mkdir build
        cd build
        cmake .. -G "Visual Studio 17 2022" -A x64 -DCMAKE_TOOLCHAIN_FILE=../vcpkg/scripts/buildsystems/vcpkg.cmake

    - name: Build project
      run: |
        cd build
        cmake --build . --config Release

    - name: Verify build
      run: |
        cd build/Release
        if exist "GenomeDatabase.exe" (
          echo "✅ BUILD SIKERES - Program elkészült!"
          dir *.exe
        ) else (
          echo "❌ BUILD SIKERTELEN - Nincs .exe fájl!"
          dir
          exit 1
        )
