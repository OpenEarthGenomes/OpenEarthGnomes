name: Windows Build
on: [push, pull_request]

jobs:
  build-windows:
    runs-on: windows-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install Visual Studio Build Tools
      uses: microsoft/setup-msbuild@v1.1.3

    - name: Download MySQL Connector (Alternative Source)
      run: |
        # Alternatív letöltési forrás
        curl -L -o mysql-connector.zip "https://cdn.mysql.com/Downloads/Connector-C++/mysql-connector-c++-8.0.37-winx64.zip"
        
        # VAGY használjunk egy már meglévő mirror-t
        # curl -L -o mysql-connector.zip "https://downloads.mysql.com/archives/get/p/31/file/mysql-connector-c++-8.0.37-winx64.zip"
        
        # Kibontás
        mkdir mysql-connector
        tar -xf mysql-connector.zip -C mysql-connector --strip-components=1
        echo "MYSQL_CONNECTOR_PATH=$pwd\mysql-connector" >> $env:GITHUB_ENV

    - name: Install INI Parser
      run: |
        git clone https://github.com/benhoyt/inih.git libs/inih

    - name: Configure with CMake
      run: |
        mkdir build
        cd build
        cmake .. -G "Visual Studio 17 2022" -A x64 -DMYSQL_CONNECTOR_PATH="$env:MYSQL_CONNECTOR_PATH"

    - name: Build project
      run: |
        cd build
        cmake --build . --config Release

    - name: Verify build
      run: |
        if exist "build\Release\GenomeDatabase.exe" (
          echo "✅ BUILD SIKERES!"
        ) else (
          echo "❌ BUILD SIKERTELEN"
          exit 1
        )
